{% extends "base.html" %}

{% block title %}Klubbans VÃ¤nner - Hem{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <section class="hero-section" style="text-align: center; padding: 4rem 0 3rem;">
        <span class="badge badge-orange" style="margin-bottom: 1rem;">VÃ¤lkommen till klubben</span>
        <h1 style="font-size: clamp(2rem, 6vw, 3.5rem); margin-bottom: 1rem;">
            <span style="background: linear-gradient(135deg, var(--orange), var(--pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Klubbans</span> VÃ¤nner
        </h1>
        <p style="font-size: 1.125rem; color: var(--gray); max-width: 500px; margin: 0 auto 2rem;">
            Snyggaste klubben och snÃ¤llaste! Vi Ã¤r alla Klubbans VÃ¤nner.
        </p>
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <a href="{{ url_for('events.index') }}" class="btn btn-primary">Se kommande turer</a>
            {% if not current_user.is_authenticated %}
                <a href="{{ url_for('auth.signup') }}" class="btn btn-secondary">Bli medlem</a>
            {% endif %}
        </div>

        <!-- Stats -->
        <div style="display: flex; gap: 3rem; justify-content: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border); flex-wrap: wrap;">
            <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; background: linear-gradient(135deg, var(--orange), var(--pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">{{ member_count }}</div>
                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gray);">Medlemmar</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; background: linear-gradient(135deg, var(--orange), var(--pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">âˆ</div>
                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gray);">Fika-stopp</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; background: linear-gradient(135deg, var(--orange), var(--pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">100%</div>
                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gray);">Kul</div>
            </div>
        </div>
    </section>

    <!-- News Section -->
    {% if news %}
    <section style="margin-top: 2rem;">
        <div class="section-label">Nyheter</div>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
            {% for item in news %}
            <div class="card" style="overflow: hidden;">
                {% if item.image_url %}
                    <div style="height: 160px; overflow: hidden;">
                        <img src="{{ item.image_url }}" style="width: 100%; height: 100%; object-fit: cover;" alt="">
                    </div>
                {% endif %}
                <div class="card-body">
                    {% if item.is_featured %}
                        <span class="badge badge-orange" style="margin-bottom: 0.5rem;">Utvalt</span>
                    {% endif %}
                    <h3 style="font-size: 1.125rem; margin-bottom: 0.5rem;">{{ item.title }}</h3>
                    <p style="color: var(--text-muted); font-size: 0.9375rem; margin-bottom: 0.75rem;">
                        {{ item.excerpt or item.content[:120] }}{% if item.content|length > 120 %}...{% endif %}
                    </p>
                    <div style="font-size: 0.8125rem; color: var(--text-light);">
                        {{ item.published_at.strftime('%d %b %Y') if item.published_at else item.created_at.strftime('%d %b %Y') }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <div style="display: grid; grid-template-columns: 1fr 320px; gap: 2rem; margin-top: 2rem;">
        <!-- Main Feed -->
        <div>
            <!-- Featured Event -->
            {% if featured_event %}
            <div style="background: linear-gradient(135deg, var(--blue-glow), var(--pink-glow)); border: 1px solid rgba(126, 200, 227, 0.3); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem;">
                <span class="badge badge-blue" style="margin-bottom: 0.75rem;">Utvalt event</span>
                <h3 style="font-size: 1.25rem; margin-bottom: 0.5rem;">{{ featured_event.title }}</h3>
                <p style="color: var(--gray); margin-bottom: 1rem;">{{ featured_event.subtitle or featured_event.description[:100] }}</p>
                <div style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
                    <span style="color: var(--light-blue);">ğŸ“… {{ featured_event.date.strftime('%d %b %Y') }}</span>
                    {% if featured_event.location %}
                        <span style="color: var(--gray);">ğŸ“ {{ featured_event.location }}</span>
                    {% endif %}
                </div>
                <a href="{{ url_for('events.detail', event_id=featured_event.id) }}" class="btn btn-primary" style="margin-top: 1rem;">LÃ¤s mer â†’</a>
            </div>
            {% endif %}

            <!-- Upcoming Events -->
            <div class="section-label">Kommande turer</div>
            {% if upcoming_events %}
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    {% for event in upcoming_events %}
                    <a href="{{ url_for('events.detail', event_id=event.id) }}" class="event-card" style="text-decoration: none; color: inherit;">
                        <div class="event-card-header">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div class="event-icon {{ event.event_type or 'ride' }}">
                                    {% if event.event_type == 'social' %}â˜•{% elif event.event_type == 'race' %}ğŸ{% else %}ğŸš´{% endif %}
                                </div>
                                <div>
                                    <div style="font-size: 0.6875rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--gray);">
                                        {{ event.event_type or 'Grupptur' }}
                                    </div>
                                    <h3 class="event-title">{{ event.title }}</h3>
                                </div>
                            </div>
                            <div class="event-date-badge">
                                <div class="event-date-day">{{ event.date.strftime('%d') }}</div>
                                <div class="event-date-month">{{ event.date.strftime('%b') }}</div>
                            </div>
                        </div>
                        <div class="event-meta">
                            {% if event.location %}
                                <span class="event-meta-item">ğŸ“ {{ event.location }}</span>
                            {% endif %}
                            <span class="event-meta-item">ğŸ• {{ event.date.strftime('%H:%M') }}</span>
                            {% if event.distance_km %}
                                <span class="event-meta-item">ğŸ“ {{ event.distance_km|int }} km</span>
                            {% endif %}
                        </div>
                    </a>
                    {% endfor %}
                </div>
                <a href="{{ url_for('events.index') }}" class="btn btn-secondary" style="margin-top: 1.5rem; width: 100%;">Se alla turer â†’</a>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸš´</div>
                    <p class="empty-state-text">Inga kommande turer just nu.</p>
                    {% if current_user.is_authenticated %}
                        <a href="{{ url_for('events.create') }}" class="btn btn-primary">Skapa en tur</a>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Recent Stories -->
            {% if recent_stories %}
            <div class="section-label" style="margin-top: 3rem;">Senaste berÃ¤ttelser</div>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% for story in recent_stories %}
                <a href="{{ url_for('stories.detail', slug=story.slug) }}" class="card" style="text-decoration: none; color: inherit;">
                    <div class="card-body">
                        <h3 style="margin-bottom: 0.5rem;">{{ story.title }}</h3>
                        <p style="color: var(--gray); font-size: 0.9375rem;">{{ story.excerpt or story.content[:150] }}...</p>
                        <div style="display: flex; gap: 1rem; margin-top: 0.75rem; font-size: 0.8125rem; color: var(--gray);">
                            <span>{{ story.author.display_name }}</span>
                            <span>{{ story.published_at.strftime('%d %b %Y') }}</span>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <aside>
            <!-- Activity Feed -->
            <div class="card">
                <div class="card-header">
                    <h4 style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gray);">Aktivitet</h4>
                </div>
                <div class="card-body" style="padding: 0.5rem 1.25rem;">
                    {% if activities %}
                        {% for activity in activities %}
                        <div class="activity-item">
                            <div class="activity-avatar">
                                {{ activity.user.display_name[0].upper() if activity.user.display_name else '?' }}
                            </div>
                            <div class="activity-content">
                                <div class="activity-text">{{ activity.message }}</div>
                                <div class="activity-time">{{ activity.created_at.strftime('%d %b, %H:%M') }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p style="color: var(--gray); text-align: center; padding: 2rem 0;">Ingen aktivitet Ã¤n.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Strava Leaderboard Widget - Latest Ride -->
            {% if latest_ride_leaderboard %}
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header" style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--orange)" stroke-width="2">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <h4 style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gray);">
                        Senaste turen
                    </h4>
                </div>
                <div class="card-body" style="padding: 0.5rem 1.25rem;">
                    {% for entry in latest_ride_leaderboard[:5] %}
                    <div class="leaderboard-item" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 0; {% if not loop.last %}border-bottom: 1px solid var(--border);{% endif %}">
                        <div style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; flex-shrink: 0; {% if entry.rank == 1 %}background: linear-gradient(135deg, #ffd700, #ffb347); color: #7c5c00;{% elif entry.rank == 2 %}background: #e8e8e8; color: #555;{% elif entry.rank == 3 %}background: #f4d9b0; color: #8b6914;{% else %}background: var(--bg-secondary); color: var(--text-muted);{% endif %}">
                            {{ entry.rank }}
                        </div>
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--orange-light), var(--pink-light)); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600; color: var(--orange); flex-shrink: 0;">
                            {{ entry.display_name[0].upper() }}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <a href="{{ url_for('profile.view', username=entry.username) }}" style="font-size: 0.875rem; font-weight: 500; color: var(--text-primary); text-decoration: none; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                {{ entry.display_name }}
                            </a>
                            <div style="font-size: 0.75rem; color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                {{ entry.ride_name or 'Tur' }}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.9375rem; font-weight: 600; color: var(--orange);">
                                {{ entry.distance_mil }} mil
                            </div>
                            <div style="font-size: 0.6875rem; color: var(--text-light);">
                                ({{ entry.distance_km|int }} km)
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Year Totals Leaderboard -->
            {% if year_totals_leaderboard %}
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header" style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--pink)" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <h4 style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gray);">
                        Arstotal {{ now().year if now is defined else '' }}
                    </h4>
                </div>
                <div class="card-body" style="padding: 0.5rem 1.25rem;">
                    {% for entry in year_totals_leaderboard[:5] %}
                    <div class="leaderboard-item" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 0; {% if not loop.last %}border-bottom: 1px solid var(--border);{% endif %}">
                        <div style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; flex-shrink: 0; {% if entry.rank == 1 %}background: linear-gradient(135deg, #ffd700, #ffb347); color: #7c5c00;{% elif entry.rank == 2 %}background: #e8e8e8; color: #555;{% elif entry.rank == 3 %}background: #f4d9b0; color: #8b6914;{% else %}background: var(--bg-secondary); color: var(--text-muted);{% endif %}">
                            {{ entry.rank }}
                        </div>
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--orange-light), var(--pink-light)); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600; color: var(--orange); flex-shrink: 0;">
                            {{ entry.display_name[0].upper() }}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <a href="{{ url_for('profile.view', username=entry.username) }}" style="font-size: 0.875rem; font-weight: 500; color: var(--text-primary); text-decoration: none; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                {{ entry.display_name }}
                            </a>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">
                                {{ entry.ride_count }} turer
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.9375rem; font-weight: 600; color: var(--pink);">
                                {{ entry.total_mil }} mil
                            </div>
                            <div style="font-size: 0.6875rem; color: var(--text-light);">
                                {{ entry.total_elevation }}m hojd
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Strava Connect CTA (for logged-in users without Strava connected) -->
            {% if current_user.is_authenticated and not current_user.strava_token %}
            <div class="card" style="margin-top: 1.5rem; background: linear-gradient(135deg, #fc4c02 0%, #ff6b35 100%); border: none;">
                <div class="card-body" style="text-align: center; color: white;">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸš´</div>
                    <h4 style="font-size: 0.9375rem; margin-bottom: 0.5rem; color: white;">Koppla Strava</h4>
                    <p style="font-size: 0.8125rem; opacity: 0.9; margin-bottom: 1rem;">
                        Synka dina turer och tÃ¤vla pÃ¥ topplistan!
                    </p>
                    <a href="{{ url_for('strava.connect') }}" class="btn" style="background: white; color: #fc4c02; font-weight: 600;">
                        Anslut till Strava
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- About Card -->
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-body">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">ğŸ”®</span>
                        <span style="font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--pink);">Mysteriet</span>
                    </div>
                    <p style="font-size: 0.875rem; color: var(--gray); line-height: 1.6;">
                        Vem Ã¤r Klubban? Ingen vet sÃ¤kert. Somliga sÃ¤ger att Klubban Ã¤r en legend,
                        andra att Klubban finns i oss alla. En sak Ã¤r sÃ¤ker: vi Ã¤r alla Klubbans vÃ¤nner.
                    </p>
                </div>
            </div>

            <!-- Quick Actions -->
            {% if current_user.is_authenticated %}
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-body">
                    <h4 style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gray); margin-bottom: 1rem;">SnabbÃ¥tgÃ¤rder</h4>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <a href="{{ url_for('events.create') }}" class="btn btn-secondary" style="justify-content: flex-start;">ğŸš´ Skapa tur</a>
                        <a href="{{ url_for('stories.create') }}" class="btn btn-secondary" style="justify-content: flex-start;">ğŸ“– Skriv berÃ¤ttelse</a>
                        <a href="{{ url_for('gallery.upload') }}" class="btn btn-secondary" style="justify-content: flex-start;">ğŸ“¸ Ladda upp bilder</a>
                    </div>
                </div>
            </div>
            {% endif %}
        </aside>
    </div>
</div>

<style>
@media (max-width: 900px) {
    .container > div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
    }
    aside {
        order: -1;
    }
}
</style>
{% endblock %}
